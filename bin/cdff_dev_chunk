#!/usr/bin/env python3
import argparse
import math
import msgpack
from cdff_dev import logloader


def main():
    args = parse_args()
    log = logloader.load_log(args.filename)
    chunks = logloader.chunk_log(log, args.stream_name, args.chunk_size)
    output_filename = args.filename
    if output_filename.endswith(".msg"):
        output_filename = output_filename[:-4]
    logloader.save_chunks(chunks, output_filename)


def parse_args():
    argparser = argparse.ArgumentParser(
        description="Chunk logs to smaller files. Name of output files will "
                    "be the old name with additional counter that indicates "
                    "the order of the chunks.")
    argparser.add_argument(
        "filename", type=str, help="Name of the logfile")
    argparser.add_argument(
        "stream_name", type=str,
         help="Name of the stream that will be extracted")
    argparser.add_argument(
        "chunk_size", type=int, help="Number of samples per file")
    args = argparser.parse_args()
    return args


if __name__ == "__main__":
    main()